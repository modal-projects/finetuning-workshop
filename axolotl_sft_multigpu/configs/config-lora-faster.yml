base_model: meta-llama/Llama-3.1-8B

plugins:
  - axolotl.integrations.cut_cross_entropy.CutCrossEntropyPlugin

dataset_prepared_path: last_run_prepared

special_tokens:
  pad_token: <|end_of_text|>


adapter: lora
lora_model_dir:
lora_r: 32
lora_alpha: 16
lora_dropout: 0
lora_target_linear: true
lora_modules_to_save:
  - embed_tokens
  - lm_head

# These make lora training 2x faster.
lora_mlp_kernel: true
lora_qkv_kernel: true
lora_o_kernel: true

fsdp_version: 2
fsdp_config:
  offload_params: false
  state_dict_type: FULL_STATE_DICT
  auto_wrap_policy: TRANSFORMER_BASED_WRAP
  transformer_layer_cls_to_wrap: LlamaDecoderLayer
  reshard_after_forward: true

datasets:
  - path: yahma/alpaca-cleaned
    type: alpaca

output_dir: /checkpoints/lora-faster-out/

sequence_len: 2048
sample_packing: true
flash_attention: true

gradient_accumulation_steps: 1
micro_batch_size: 8
num_epochs: 2
optimizer: adamw_torch_fused
lr_scheduler: constant_with_warmup
learning_rate: 2e-6

bf16: true
tf32: true

logging_steps: 1
saves_per_epoch: 1

warmup_ratio: 0.1
